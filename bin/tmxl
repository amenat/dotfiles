#!/bin/bash

# TMUX launcher

DEFAULT_SESS_NAME="$(basename "$PWD" | tr . -)"

if [[ -z "$1" ]]; then
    # use default session name
    SESS_NAME="$DEFAULT_SESS_NAME"
else
    SESS_NAME="$1"
fi

# check if session already exists
if ! tmux has-session -t "$SESS_NAME"; then
    # create and detach from session
    tmux new-session -s "$SESS_NAME" -d

    # rename default window
    tmux rename-window -t "$SESS_NAME:1" "editor"

    # Create background window
    tmux new-window -t "$SESS_NAME:2" -n "shell"

    # launch vim
    tmux send-keys -t "$SESS_NAME:1" nvim Enter

    # Select window #1
    tmux select-window -t "$SESS_NAME:1"

    # Attach to session and clear bells
    sleep 3 && tmux kill-session -C -t "$SESS_NAME" &
    tmux attach-session -t "$SESS_NAME"
fi
tmux attach -t "$SESS_NAME"
